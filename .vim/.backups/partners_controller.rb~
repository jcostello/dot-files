class PartnersController < ActionController::Base
  http_basic_authenticate_with name: "Restorando", password: "RestaurantsFeed", only: [:activities, :activity]

  def widget
    @restaurant = Redo::Restaurant.find(params[:restaurant_id])
    @locale = params[:locale] || @restaurant.country.locale
    @referrer = params[:referrer] || request.headers["HTTP_REFERER"]
    @origin = params[:origin] || "restorando"
    I18n.locale = @locale.to_sym

    tpl = "widget_#{params[:id]}"
    render tpl
  end

  def activities
    @activities = Redo::PublishingActivity.restaurants_feed_for(params[:country])
    I18n.locale = RCore::Country.find(params[:country]).locale
    # this will be our Feed's update timestamp
    @updated = @activities.first.updated_at unless @activities.empty?

    respond_to do |format|
      format.atom { render :layout => false }
      # we want the RSS feed to redirect permanently to the ATOM feed
      format.rss { redirect_to partners_feed_activity_path(params[:country], :format => :atom), :status => :moved_permanently }
    end
  end

  def activity
    @activity   = Redo::PublishingActivity.find(params[:id])
    I18n.locale = @activity.model.country.locale
  end

end
